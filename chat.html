<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NiamChat</title>
    <link rel="stylesheet" href="css/styles.css">
      <link rel="icon" type="image/png" href="https://niamco.github.io/niamchatNOTWORKING/favicon.png">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Theme Picker -->
    <div class="theme-picker" id="themePicker">
        <button class="theme-toggle-btn" id="themeToggleBtn">
            <div class="theme-icon" id="themeIcon"></div>
        </button>
        <div class="theme-grid" id="themeGrid">
            <div class="theme-option theme-seaside active" data-theme="seaside">
                <div class="theme-icon-small" id="themeSeasideIcon"></div>
            </div>
            <div class="theme-option theme-cozy" data-theme="cozy">
                <div class="theme-icon-small" id="themeCozyIcon"></div>
            </div>
            <div class="theme-option theme-neon" data-theme="neon">
                <div class="theme-icon-small" id="themeNeonIcon"></div>
            </div>
            <div class="theme-option theme-forest" data-theme="forest">
                <div class="theme-icon-small" id="themeForestIcon"></div>
            </div>
            <div class="theme-option theme-winter" data-theme="winter">
                <div class="theme-icon-small" id="themeWinterIcon"></div>
            </div>
            <div class="theme-option theme-starry" data-theme="starry">
                <div class="theme-icon-small" id="themeStarryIcon"></div>
            </div>
            <div class="theme-option theme-candy" data-theme="candy">
                <div class="theme-icon-small" id="themeCandyIcon"></div>
            </div>
            <div class="theme-option theme-desert" data-theme="desert">
                <div class="theme-icon-small" id="themeDesertIcon"></div>
            </div>
            <div class="theme-option theme-arcade" data-theme="arcade">
                <div class="theme-icon-small" id="themeArcadeIcon"></div>
            </div>
            <div class="theme-option theme-autumn" data-theme="autumn">
                <div class="theme-icon-small" id="themeAutumnIcon"></div>
            </div>
        </div>
    </div>

    <!-- Admin Controls -->
    <div class="admin-controls" id="adminControls">
        <button class="admin-btn" id="adminToggleBtn">
            <div class="icon-small" id="adminSettingsIcon"></div>
            Admin Controls
        </button>
        <div class="admin-panel" id="adminPanel">
            <div class="admin-section">
                <h3>User Management</h3>
                <button class="control-btn" id="kickUserBtn">
                    <div class="icon-small" id="kickIcon"></div>
                    Kick User
                </button>
                <button class="control-btn" id="grantAdminBtn">
                    <div class="icon-small" id="grantAdminIcon"></div>
                    Grant Admin
                </button>
                <button class="control-btn" id="revokeAdminBtn">
                    <div class="icon-small" id="revokeAdminIcon"></div>
                    Revoke Admin
                </button>
            </div>
            <div class="admin-section">
                <h3>Announcements</h3>
                <button class="control-btn" id="announceBtn">
                    <div class="icon-small" id="announceIcon"></div>
                    Send Announcement
                </button>
            </div>
            <div class="admin-section">
                <h3>Chat Management</h3>
                <button class="control-btn" id="clearChatBtn">
                    <div class="icon-small" id="clearChatIcon"></div>
                    Clear Chat
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon" id="notificationBellIcon"></div>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle"></div>
            <div class="notification-message" id="notificationMessage"></div>
        </div>
        <button class="notification-close" id="notificationClose">
            <div class="icon-small" id="notificationCloseIcon"></div>
        </button>
    </div>

    <!-- Image Preview Modal -->
    <div class="image-preview" id="imagePreview">
        <img class="preview-image" id="previewImage" src="" alt="Preview">
        <button class="preview-close" id="previewClose">
            <div class="icon-small" id="previewCloseIcon"></div>
        </button>
    </div>

    <!-- Announcement Modal -->
    <div class="modal" id="announcementModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Send Announcement</h2>
                <button class="modal-close" id="announcementModalClose">
                    <div class="icon-small" id="announcementModalCloseIcon"></div>
                </button>
            </div>
            <textarea 
                id="announcementText" 
                class="message-input" 
                placeholder="Enter announcement message..."
                rows="4"></textarea>
            <button class="send-btn mt-4" id="sendAnnouncementBtn">
                <div class="send-btn-icon" id="sendAnnouncementIcon"></div>
                Send Announcement
            </button>
        </div>
    </div>

    <!-- Kick User Modal -->
    <div class="modal" id="kickUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Kick User</h2>
                <button class="modal-close" id="kickUserModalClose">
                    <div class="icon-small" id="kickUserModalCloseIcon"></div>
                </button>
            </div>
            <div class="mb-4">
                <label for="kickUsername" class="block mb-2">Username to kick:</label>
                <input 
                    type="text" 
                    id="kickUsername" 
                    class="message-input" 
                    placeholder="Enter username">
            </div>
            <button class="send-btn" id="confirmKickBtn">
                <div class="send-btn-icon" id="confirmKickIcon"></div>
                Kick User
            </button>
        </div>
    </div>

    <!-- Grant Admin Modal -->
    <div class="modal" id="grantAdminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Grant Admin</h2>
                <button class="modal-close" id="grantAdminModalClose">
                    <div class="icon-small" id="grantAdminModalCloseIcon"></div>
                </button>
            </div>
            <div class="mb-4">
                <label for="grantAdminUsername" class="block mb-2">Username to grant admin:</label>
                <input 
                    type="text" 
                    id="grantAdminUsername" 
                    class="message-input" 
                    placeholder="Enter username">
            </div>
            <button class="send-btn" id="confirmGrantAdminBtn">
                <div class="send-btn-icon" id="confirmGrantAdminIcon"></div>
                Grant Admin
            </button>
        </div>
    </div>

    <!-- Revoke Admin Modal -->
    <div class="modal" id="revokeAdminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Revoke Admin</h2>
                <button class="modal-close" id="revokeAdminModalClose">
                    <div class="icon-small" id="revokeAdminModalCloseIcon"></div>
                </button>
            </div>
            <div class="mb-4">
                <label for="revokeAdminUsername" class="block mb-2">Username to revoke admin:</label>
                <input 
                    type="text" 
                    id="revokeAdminUsername" 
                    class="message-input" 
                    placeholder="Enter username">
            </div>
            <button class="send-btn" id="confirmRevokeAdminBtn">
                <div class="send-btn-icon" id="confirmRevokeAdminIcon"></div>
                Revoke Admin
            </button>
        </div>
    </div>

    <!-- Clear Chat Modal -->
    <div class="modal" id="clearChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Clear Chat</h2>
                <button class="modal-close" id="clearChatModalClose">
                    <div class="icon-small" id="clearChatModalCloseIcon"></div>
                </button>
            </div>
            <div class="mb-4">
                <p>Are you sure you want to clear all messages in this chat?</p>
                <p class="text-sm text-secondary mt-2">This action cannot be undone.</p>
            </div>
            <div class="flex gap-3">
                <button class="send-btn flex-1" id="confirmClearChatBtn">
                    <div class="send-btn-icon" id="confirmClearChatIcon"></div>
                    Clear Chat
                </button>
                <button class="send-btn flex-1" id="cancelClearChatBtn" style="background: var(--danger-color);">
                    <div class="send-btn-icon" id="cancelClearChatIcon"></div>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Main Chat Container -->
    <div class="chat-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="icon-small" id="logoIcon"></div>
                    NiamChat
                </div>
                <button class="input-btn" id="menuToggleBtn">
                    <div class="input-btn-icon" id="menuToggleIcon"></div>
                </button>
            </div>

            <div class="user-info">
                <div class="user-avatar" id="userAvatar">
                    <span id="userInitials">U</span>
                    <div class="online-dot"></div>
                </div>
                <div class="user-details">
                    <div class="username">
                        <span id="displayUsername">User</span>
                        <div class="icon-small" id="userRoleBadge"></div>
                    </div>
                    <div class="user-role" id="userRoleText">User</div>
                </div>
            </div>

            <div class="chat-rooms">
                <div class="room-item active" data-room="public" id="publicChatBtn">
                    <div class="room-icon" id="publicChatIcon"></div>
                    <div class="room-name">Public Chat</div>
                    <div class="room-badge" id="publicBadge">0</div>
                </div>
                <div class="room-item" data-room="admin" id="adminChatBtn">
                    <div class="room-icon" id="adminChatIcon"></div>
                    <div class="room-name">Admin Chat</div>
                    <div class="room-badge" id="adminBadge">0</div>
                </div>
                   <div class="room-item" id="privateChatBtn">
                     <div class="room-icon" id="privateChatIcon"></div>
                     <div class="room-name">Private Chat</div>
                     <div class="room-badge" id="privateBadge">↗</div>
                </div>
            </div>

            <div class="online-users">
                <div class="online-users-title">Online Users (<span id="onlineCount">0</span>)</div>
                <div id="onlineUsersList">
                    <!-- Online users will be inserted here -->
                </div>
            </div>

            <div class="sidebar-footer">
                <button class="sidebar-btn" id="logoutBtn">
                    <div class="sidebar-btn-icon" id="logoutIcon"></div>
                    Logout
                </button>
                <button class="sidebar-btn" id="reloadBtn">
                    <div class="sidebar-btn-icon" id="reloadIcon"></div>
                    Reload
                </button>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-chat">
            <div class="chat-header">
                <div class="chat-title">
                    <div class="icon-small" id="currentChatIcon"></div>
                    <span id="currentChatTitle">Public Chat</span>
                </div>
                <div class="chat-actions">
                    <button class="action-btn" id="toggleSidebarBtn">
                        <div class="input-btn-icon" id="toggleSidebarIcon"></div>
                        Toggle Sidebar
                    </button>
                    <button class="action-btn" id="markReadBtn">
                        <div class="input-btn-icon" id="markReadIcon"></div>
                        Mark Read
                    </button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <!-- Messages will be inserted here -->
                <div class="empty-state">
                    <div class="empty-icon" id="emptyStateIcon"></div>
                    <h3>No messages yet</h3>
                    <p class="text-secondary">Be the first to send a message!</p>
                </div>
            </div>

            <div class="typing-container" id="typingContainer" style="display: none;">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <span class="typing-indicator" id="typingText">someone is typing...</span>
            </div>

            <div class="message-input-container">
                <div class="input-actions">
                    <button class="input-btn" id="attachImageBtn" title="Attach Image">
                        <div class="input-btn-icon" id="attachImageIcon"></div>
                    </button>
                    <button class="input-btn" id="emojiToggleBtn" title="Emojis Disabled" disabled>
                        <div class="input-btn-icon" id="emojiToggleIcon"></div>
                    </button>
                </div>
                <div class="input-area">
                    <textarea 
                        id="messageInput" 
                        class="message-input" 
                        placeholder="Type your message here (emojis disabled)..."
                        rows="2"></textarea>
                    <button class="send-btn" id="sendMessageBtn">
                        <div class="send-btn-icon" id="sendMessageIcon"></div>
                        Send
                    </button>
                </div>
                <div class="text-sm text-secondary mt-2">
                    <span id="charCount">0/1000</span> • Press Enter to send, Shift+Enter for new line
                </div>
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/supabase-config.js"></script>
    <script src="js/icons.js"></script>
    <script src="js/icon-loader.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/chat-core.js"></script>
    <script src="js/realtime.js"></script>
    <script src="js/upload.js"></script>
    <script src="js/themes.js"></script>
    <script src="js/admin-controls.js"></script>
    <script src="js/announcements.js"></script>

    <script>
        // Function to load all icons after DOM is ready
        function loadAllIcons() {
            // Icon mapping - match HTML IDs to icon names
            const iconMap = {
                // Theme picker icons
                'themeIcon': 'themePicker',
                'themeSeasideIcon': 'themeSeaside',
                'themeCozyIcon': 'themeCozy',
                'themeNeonIcon': 'themeNeon',
                'themeForestIcon': 'themeForest',
                'themeWinterIcon': 'themeWinter',
                'themeStarryIcon': 'themeStarry',
                'themeCandyIcon': 'themeCandy',
                'themeDesertIcon': 'themeDesert',
                'themeArcadeIcon': 'themeArcade',
                'themeAutumnIcon': 'themeAutumn',
                
                // Admin controls icons
                'adminSettingsIcon': 'settings',
                'kickIcon': 'kick',
                'grantAdminIcon': 'grantAdmin',
                'revokeAdminIcon': 'revokeAdmin',
                'announceIcon': 'announce',
                'clearChatIcon': 'delete',
                
                // Notification icons
                'notificationBellIcon': 'notification',
                'notificationCloseIcon': 'close',
                
                // Modal close icons
                'announcementModalCloseIcon': 'close',
                'kickUserModalCloseIcon': 'close',
                'grantAdminModalCloseIcon': 'close',
                'revokeAdminModalCloseIcon': 'close',
                'clearChatModalCloseIcon': 'close',
                'previewCloseIcon': 'close',
                
                // Modal action icons
                'sendAnnouncementIcon': 'send',
                'confirmKickIcon': 'kick',
                'confirmGrantAdminIcon': 'grantAdmin',
                'confirmRevokeAdminIcon': 'revokeAdmin',
                'confirmClearChatIcon': 'delete',
                'cancelClearChatIcon': 'close',
                
                // Sidebar icons
                'logoIcon': 'publicChat',
                'menuToggleIcon': 'menu',
                'publicChatIcon': 'publicChat',
                'adminChatIcon': 'adminChat',
                'privateChatIcon': 'privateChat',
                'logoutIcon': 'logout',
                'reloadIcon': 'reload',
                
                // Chat header icons
                'currentChatIcon': 'publicChat',
                'toggleSidebarIcon': 'menu',
                'markReadIcon': 'checkmark',
                
                // Empty state icon
                'emptyStateIcon': 'publicChat',
                
                // Message input icons
                'attachImageIcon': 'attach',
                'emojiToggleIcon': 'close',
                'sendMessageIcon': 'send'
            };
            
            // Load each icon
            Object.keys(iconMap).forEach(elementId => {
                const element = document.getElementById(elementId);
                const iconName = iconMap[elementId];
                
                if (element && window.getIcon && window.getIcon(iconName)) {
                    element.innerHTML = window.getIcon(iconName);
                } else if (element) {
                    console.warn(`Could not load icon: ${iconName} for element: ${elementId}`);
                }
            });
            
            // Special handling for user role badge (will be set by auth.js)
            console.log('All icons loaded successfully');
        }
        
        // Load icons when DOM is ready
        document.addEventListener('DOMContentLoaded', loadAllIcons);
        
        // Also load icons when window loads (fallback)
        window.addEventListener('load', loadAllIcons);
        
        // Load icons after a short delay (in case icons.js loads slowly)
        setTimeout(loadAllIcons, 1000);
    </script>
    <script>
    // Add click handler for private chat button
    document.addEventListener('DOMContentLoaded', function() {
        const privateChatBtn = document.getElementById('privateChatBtn');
        
        if (privateChatBtn) {
            privateChatBtn.addEventListener('click', function() {
                // Open private chat in new tab
                window.open('https://niamco.github.io/private-chat', '_blank');
            });
            
            // Remove link styling
            privateChatBtn.style.textDecoration = 'none';
            privateChatBtn.style.color = 'inherit';
            privateChatBtn.style.cursor = 'pointer';
        }
    });
</script>
</body>
</html>
